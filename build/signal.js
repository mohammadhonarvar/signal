globalThis.Alwatr==null&&(globalThis.Alwatr={registeredList:[]});try{_ALWATR_VERSION_}catch(e){globalThis._ALWATR_VERSION_="ERROR",console.warn("!! SCRIPTS LOADED OUTSIDE OF ALWATR BUILD ENVIRONMENT !!")}Alwatr.registeredList==null&&(Alwatr.registeredList=[]);var m=Alwatr;m.registeredList.push({name:"@alwatr/logger",version:_ALWATR_VERSION_});var f=typeof process!="undefined",O,_=f?process.env.ALWATR_DEBUG==="1":((O=globalThis.localStorage)==null?void 0:O.getItem("alwatrDebug"))==="1",A=f?["0;36","0;35","0;34","0;33","0;32"]:["#35b997","#f05561","#ee224a","#91c13e","#22af4b","#f0e995","#0fe995","#0f89ca","#08b9a5","#fee851","#ee573d","#f9df30","#1da2dc","#f05123","#ee2524"],x=0,C=()=>{let e=A[x];return x++,x>=A.length&&(x=0),e},i={scope:f?"\x1B[{{color}}m":"color: {{color}};",reset:f?"\x1B[0m":"color: inherit;"},T=f?"%s%s%s":"%c%s%c",D=e=>{e=e.trim();let r=e.charAt(0);return r!=="["&&r!=="{"&&r!=="<"&&(e="["+e+"]"),e},p=(e,r=_)=>{let t=C(),n=i.scope.replaceAll("{{color}}",t);e=D(e);let s={devMode:r,domain:e,accident:f?console.warn.bind(console,`${n}⚠️
%s\x1B[33m.%s() Accident \`%s\` %s!${i.reset}`,e):console.warn.bind(console,"%c%s%c.%s() Accident `%s` %s!",n,e,i.reset),error:f?console.error.bind(console,`${n}❌
%s\x1B[31m.%s() Error \`%s\`${i.reset}
`,e):console.error.bind(console,"%c%s%c.%s() Error `%s`\n",n,e,i.reset)};return r?{...s,logProperty:console.debug.bind(console,T+".%s = %o;",n,e,i.reset),logMethod:console.debug.bind(console,T+".%s();",n,e,i.reset),logModule:console.debug.bind(console,T+"/%s.js;",n,e,i.reset),logMethodArgs:console.debug.bind(console,T+".%s(%o);",n,e,i.reset),logMethodFull:console.debug.bind(console,T+".%s(%o) => %o",n,e,i.reset),logOther:console.debug.bind(console,T,n,e,i.reset),incident:f?console.log.bind(console,`${n}🚸
%s${i.reset}.%s() Incident \`%s\` %s!${i.reset}`,e):console.log.bind(console,"%c%s%c.%s() Incident `%s` %s!",n,e,"color: orange;"),time:o=>console.time(e+"."+o+" duration time"),timeEnd:o=>console.timeEnd(e+"."+o+" duration time")}:s};m.registeredList.push({name:"signal",version:"1.0.0"});var v=5,c={},d="eventTarget"in window?new EventTarget:document.createElement("span");function w(e,r=!1){let t=c[e];if(t!=null){for(let n of t.listenerList)d.removeEventListener(e,n.callback);if(r){delete c[e];return}t.listenerList.length=0}}function j(){let e=Object.keys(c);for(let r of e)w(r,!0)}var l=p("context-signal"),h=0,L=e=>{let r=c[e];return r==null&&(r=c[e]={id:e,disabled:!1,debounced:!1,detail:void 0,listenerList:[]}),r},k=(e,r,t=!1)=>{var s;(s=l.logMethodArgs)==null||s.call(l,"setContextSignalValue",{signalId:e,value:r,replaceAll:t});let n=L(e);return n.detail===void 0||t?(n.detail=r,n):typeof n.detail=="object"&&!Array.isArray(n.detail)&&typeof r=="object"?(n.detail={...n.detail,...r},n):(n.detail=r,n)},B=e=>L(e).detail;function z(e,r,t={}){var o,a,u;(o=t.debounce)!=null||(t.debounce="NextCycle"),(a=t.scopeName)!=null||(t.scopeName="unknown"),(u=l.logMethodArgs)==null||u.call(l,"contextDispatch",{signalId:e,value:r,options:t});let n=k(e,r,t.replaceAll);if(n.disabled)return;let s=()=>{d.dispatchEvent(new CustomEvent(e,{detail:r}))};if(t.debounce==="No"){s();return}if(t.debounce==="NextCycle"){setTimeout(s,0);return}n.debounced!==!0&&(n.debounced=!0,t.debounce==="AnimationFrame"?requestAnimationFrame(s):setTimeout(s,v))}function N(e,r,t={}){var o,a,u;(o=t.preserved)!=null||(t.preserved=!0),(a=l.logMethodArgs)==null||a.call(l,"onContextDispatch",{signalId:e,callback:r,options:t});let n=L(e);if(n.disabled)return h;let s=b=>{try{r(b.detail)}catch(y){l.error("onContextDispatch","call_signal_callback_failed",y,{signalId:n.id})}};return n.listenerList.push({id:++h,signalId:n.id,once:(u=t.once)!=null?u:!1,callback:s}),d.addEventListener(e,b=>{t.runAsLatest?setTimeout(()=>{s(b)},0):s(b)},{once:t.once}),t.preserved&&setTimeout(r,0,n.detail),h}function R(e,r){let t=c[e];if(t==null)return;let n=t.listenerList.findIndex(s=>s.id===r);n>-1&&d.removeEventListener(e,t.listenerList[n].callback)}function G(e,r){let t=!1;return new Promise(n=>{let s=N(e,o=>{typeof r=="function"?r(o)===!0&&(t=!0,n()):n(),t&&R(e,s)})})}var g=p("simple-signal"),E=0,S=e=>{let r=c[e];return r==null&&(r=c[e]={id:e,disabled:!1,debounced:!1,listenerList:[]}),r};function Q(e,r={}){var s,o;(s=r.debounce)!=null||(r.debounce="NextCycle"),(o=g.logMethodArgs)==null||o.call(g,"dispatch",{signalId:e,options:r});let t=S(e);if(t.disabled)return;let n=()=>{d.dispatchEvent(new CustomEvent(e))};if(r.debounce==="No"){n();return}if(r.debounce==="NextCycle"){setTimeout(n,0);return}t.debounced!==!0&&(t.debounced=!0,r.debounce==="AnimationFrame"?requestAnimationFrame(n):setTimeout(n,v))}function P(e,r,t={}){var o,a,u;(o=t.preserved)!=null||(t.preserved=!0),(a=g.logMethodArgs)==null||a.call(g,"onDispatch",{signalId:e,callback:r,options:t});let n=S(e);if(n.disabled)return E;let s=()=>{try{r()}catch(b){g.error("onContextDispatch","call_signal_callback_failed",b,{signalId:n.id})}};return n.listenerList.push({id:++E,signalId:n.id,once:(u=t.once)!=null?u:!1,callback:s}),d.addEventListener(e,()=>{t.runAsLatest?setTimeout(()=>{s()},0):s()},{once:t.once}),t.preserved&&setTimeout(r,0),E}function M(e,r){let t=c[e];if(t==null)return;let n=t.listenerList.findIndex(s=>s.id===r);n>-1&&d.removeEventListener(e,t.listenerList[n].callback)}function X(e){return new Promise(r=>{let t=P(e,()=>{r(),M(e,t)})})}export{z as contextDispatch,Q as dispatch,G as firstContextDispatch,X as firstDispatch,B as getContextSignalValue,N as onContextDispatch,P as onDispatch,R as removeOnContextDispatch,M as removeOnDispatch,j as resetSignalObject,k as setContextSignalValue};
//# sourceMappingURL=signal.js.map
