globalThis.Alwatr==null&&(globalThis.Alwatr={registeredList:[]});try{_ALWATR_VERSION_}catch(e){globalThis._ALWATR_VERSION_="ERROR",console.warn("!! SCRIPTS LOADED OUTSIDE OF ALWATR BUILD ENVIRONMENT !!")}Alwatr.registeredList==null&&(Alwatr.registeredList=[]);var p=Alwatr;p.registeredList.push({name:"@alwatr/logger",version:_ALWATR_VERSION_});var f=typeof process!="undefined",D,C=f?process.env.ALWATR_DEBUG==="1":((D=globalThis.localStorage)==null?void 0:D.getItem("alwatrDebug"))==="1",T=f?["0;36","0;35","0;34","0;33","0;32"]:["#35b997","#f05561","#ee224a","#91c13e","#22af4b","#f0e995","#0fe995","#0f89ca","#08b9a5","#fee851","#ee573d","#f9df30","#1da2dc","#f05123","#ee2524"],m=0,v=()=>{let e=T[m];return m++,m>=T.length&&(m=0),e},c={scope:f?"\x1B[{{color}}m":"color: {{color}};",reset:f?"\x1B[0m":"color: inherit;"},x=f?"%s%s%s":"%c%s%c",O=e=>{e=e.trim();let r=e.charAt(0);return r!=="["&&r!=="{"&&r!=="<"&&(e="["+e+"]"),e},h=(e,r=C)=>{let n=v(),t=c.scope.replaceAll("{{color}}",n);e=O(e);let o={devMode:r,domain:e,accident:f?console.warn.bind(console,`${t}⚠️
%s\x1B[33m.%s() Accident \`%s\` %s!${c.reset}`,e):console.warn.bind(console,"%c%s%c.%s() Accident `%s` %s!",t,e,c.reset),error:f?console.error.bind(console,`${t}❌
%s\x1B[31m.%s() Error \`%s\`${c.reset}
`,e):console.error.bind(console,"%c%s%c.%s() Error `%s`\n",t,e,c.reset)};return r?{...o,logProperty:console.debug.bind(console,x+".%s = %o;",t,e,c.reset),logMethod:console.debug.bind(console,x+".%s();",t,e,c.reset),logModule:console.debug.bind(console,x+"/%s.js;",t,e,c.reset),logMethodArgs:console.debug.bind(console,x+".%s(%o);",t,e,c.reset),logMethodFull:console.debug.bind(console,x+".%s(%o) => %o",t,e,c.reset),logOther:console.debug.bind(console,x,t,e,c.reset),incident:f?console.log.bind(console,`${t}🚸
%s${c.reset}.%s() Incident \`%s\` %s!${c.reset}`,e):console.log.bind(console,"%c%s%c.%s() Incident `%s` %s!",t,e,"color: orange;"),time:s=>console.time(e+"."+s+" duration time"),timeEnd:s=>console.timeEnd(e+"."+s+" duration time")}:o};p.registeredList.push({name:"signal",version:"1.0.0"});var A=5,i={},u="eventTarget"in window?new EventTarget:document.createElement("span");function y(e,r=!1){let n=i[e];if(n!=null){for(let t of n.listenerList)u.removeEventListener(e,t.callback);if(r){delete i[e];return}n.listenerList.length=0}}function N(){let e=Object.keys(i);for(let r of e)y(r,!0)}var l=h("context-signal"),L=0,_=e=>{let r=i[e];return r==null&&(r=i[e]={id:e,disabled:!1,debounced:!1,detail:void 0,listenerList:[]}),r},R=(e,r,n=!1)=>{var o;(o=l.logMethodArgs)==null||o.call(l,"setContextSignalValue",{signalId:e,value:r,replaceAll:n});let t=_(e);return t.detail===void 0||n?(t.detail=r,t):typeof t.detail=="object"&&!Array.isArray(t.detail)&&typeof r=="object"?(t.detail={...t.detail,...r},t):(t.detail=r,t)},B=e=>_(e).detail;function z(e,r,n={}){var s,a,d;(s=n.debounce)!=null||(n.debounce="NextCycle"),(a=n.scopeName)!=null||(n.scopeName="unknown"),(d=l.logMethodArgs)==null||d.call(l,"contextDispatch",{signalId:e,value:r,options:n});let t=R(e,r,n.replaceAll);if(t.disabled)return;let o=()=>{u.dispatchEvent(new CustomEvent(e,{detail:r}))};if(n.debounce==="No"){o();return}if(n.debounce==="NextCycle"){setTimeout(o,0);return}t.debounced!==!0&&(t.debounced=!0,n.debounce==="AnimationFrame"?requestAnimationFrame(o):setTimeout(o,A))}function M(e,r,n={}){var s,a,d;(s=n.preserved)!=null||(n.preserved=!0),(a=l.logMethodArgs)==null||a.call(l,"onContextDispatch",{signalId:e,callback:r,options:n});let t=_(e);if(t.disabled)return L;let o=g=>{try{r(g.detail)}catch(w){l.error("onContextDispatch","call_signal_callback_failed",w,{signalId:t.id})}};return t.listenerList.push({id:++L,signalId:t.id,once:(d=n.once)!=null?d:!1,callback:o}),u.addEventListener(e,g=>{n.runAsLatest?setTimeout(()=>{o(g)},0):o(g)},{once:n.once}),n.preserved&&setTimeout(r,0,t.detail),L}function j(e,r){let n=i[e];if(n==null)return;let t=n.listenerList.findIndex(o=>o.id===r);t>-1&&u.removeEventListener(e,n.listenerList[t].callback)}function G(e,r){let n=!1;return new Promise(t=>{let o=M(e,s=>{typeof r=="function"?r(s)===!0&&(n=!0,t()):t(),n&&j(e,o)})})}var b=h("simple-signal"),E=0,S=e=>{let r=i[e];return r==null&&(r=i[e]={id:e,disabled:!1,debounced:!1,listenerList:[]}),r};function Q(e,r={}){var o,s;(o=r.debounce)!=null||(r.debounce="NextCycle"),(s=b.logMethodArgs)==null||s.call(b,"dispatch",{signalId:e,options:r});let n=S(e);if(n.disabled)return;let t=()=>{u.dispatchEvent(new CustomEvent(e))};if(r.debounce==="No"){t();return}if(r.debounce==="NextCycle"){setTimeout(t,0);return}n.debounced!==!0&&(n.debounced=!0,r.debounce==="AnimationFrame"?requestAnimationFrame(t):setTimeout(t,A))}function k(e,r,n={}){var s,a,d;(s=n.preserved)!=null||(n.preserved=!0),(a=b.logMethodArgs)==null||a.call(b,"onDispatch",{signalId:e,callback:r,options:n});let t=S(e);if(t.disabled)return E;let o=()=>{try{r()}catch(g){b.error("onContextDispatch","call_signal_callback_failed",g,{signalId:t.id})}};return t.listenerList.push({id:++E,signalId:t.id,once:(d=n.once)!=null?d:!1,callback:o}),u.addEventListener(e,()=>{n.runAsLatest?setTimeout(()=>{o()},0):o()},{once:n.once}),n.preserved&&setTimeout(r,0),E}function V(e,r){let n=i[e];if(n==null)return;let t=n.listenerList.findIndex(o=>o.id===r);t>-1&&u.removeEventListener(e,n.listenerList[t].callback)}function X(e){return new Promise(r=>{let n=k(e,()=>{r(),V(e,n)})})}export{z as contextDispatch,Q as dispatch,G as firstContextDispatch,X as firstDispatch,B as getContextSignalValue,M as onContextDispatch,k as onDispatch,j as removeOnContextDispatch,V as removeOnDispatch,N as resetSignalObject,R as setContextSignalValue};
//# sourceMappingURL=signal.js.map
